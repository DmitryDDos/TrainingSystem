@model IEnumerable<trSys.DTOs.UserCourseDto>
@{
    Layout = "_Layout";
    ViewData["Title"] = "Мои курсы";
    var userFullName = User.FindFirstValue(ClaimTypes.Name);
}

<aside class="sidebar">
    <div class="user-profile">
        <div class="user-avatar">
            <div class="avatar-placeholder">@GetInitials(userFullName)</div>
        </div>
        <h2 class="user-name">@userFullName</h2>
    </div>

    <nav class="sidebar-nav">
        <a asp-action="MyCourses" class="sidebar-link active">📚 Мои курсы</a>
        <a href="#" class="sidebar-link">📈 Прогресс</a>
        <a href="#" class="sidebar-link">⚙️ Настройки</a>
    </nav>
</aside>

<main class="main-content">
    <h1 class="page-title">Мои курсы</h1>

    @if (!Model.Any())
    {
        <div class="empty-state">
            <p>Вы пока не записаны ни на один курс</p>
            <a asp-controller="Course" asp-action="Index" class="button">Найти курсы</a>
        </div>
    }
    else
    {
        <div class="courses-grid">
            @foreach (var course in Model)
            {
                <article class="course-card">
                    <h3>@course.Title</h3>

                    <!-- Прогресс-бар -->
                    <div class="progress-container">
                        <div class="progress-bar" style="width: @course.ProgressPercentage%"></div>
                    </div>
                    <p>Пройдено: @course.CompletedModules из @course.TotalModules модулей</p>

                    <!-- Кнопка продолжения -->
                    <a asp-controller="CourseLearning" asp-action="Index" asp-route-courseId="@course.CourseId"
                       class="button">Продолжить обучение</a>
                </article>
            }
        </div>
    }
</main>

@functions {
    private string GetInitials(string fullName)
    {
        if (string.IsNullOrWhiteSpace(fullName))
            return "??";

        var parts = fullName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        return parts.Length switch
        {
            0 => "??",
            1 => parts[0][0].ToString(),
            _ => $"{parts[0][0]}{parts[^1][0]}"
        };
    }
}
